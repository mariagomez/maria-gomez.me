<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Dropwizard and Flyway &#8211; Continuous Learner</title>
<meta name="description" content="">
<meta name="keywords" content="dropwizard, flyway, rest, db, migrations, java, frameworks, sql">
<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
		<meta name="twitter:image" content=
			
				
						"http://maria-gomez.me//images/"
				
			
		>
	
	<meta name="twitter:title" content="Dropwizard and Flyway">
	<meta name="twitter:description" content="Continuous Learner by Maria Gomez">
	<meta name="twitter:creator" content="@mariascandella">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Dropwizard and Flyway">
<meta property="og:description" content="Continuous Learner by Maria Gomez">
<meta property="og:url" content="http://maria-gomez.me//software/dropwizard-and-flyway/">
<meta property="og:site_name" content="Continuous Learner">





<link rel="canonical" href="http://maria-gomez.me//software/dropwizard-and-flyway/">
<link href="http://maria-gomez.me//feed.xml" type="application/atom+xml" rel="alternate" title="Continuous Learner Feed">
<link rel="author" href="http://plus.google.com/+mariagomezaguirre?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://maria-gomez.me//assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://maria-gomez.me//assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://maria-gomez.me//assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://maria-gomez.me//assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://maria-gomez.me//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://maria-gomez.me//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://maria-gomez.me//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://maria-gomez.me//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://maria-gomez.me//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://maria-gomez.me//images/apple-touch-icon-144x144-precomposed.png">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55460651-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://maria-gomez.me/">Continuous Learner</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://maria-gomez.me//about/" >About</a></li>
		        
				<li><a href="http://maria-gomez.me//posts/" >Posts</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
	<img src="http://maria-gomez.me//images/me_fall_2013.jpg" class="bio-photo" alt="Maria Gomez bio photo"></a>

<h3>Maria Gomez</h3>
<p>Software Developer. Agile Coach. Thoughtworker.</p>
<a href="http://twitter.com/mariascandella" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>

<a href="http://plus.google.com/+mariagomezaguirre" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://linkedin.com/in/mariagomezaguirre" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://instagram.com/mscandella" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>

<a href="http://github.com/mariagomez" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>






  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://maria-gomez.me//software/dropwizard-and-flyway/" rel="bookmark" title="Dropwizard and Flyway">Dropwizard and Flyway</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>In my current project we are developing a bunch of microservices using <a href="dropwizard.github.io/dropwizard/">Dropwizard</a>, a light weight Java framework who provides you a quick way of creating RESTful services by combining some libraries like Jersey and Jackson.
<br /><br />
One of the reason why we chose it is because it gives you a lot of stuff out of the box (like <a href="http://dropwizard.readthedocs.org/en/latest/manual/core.html#metrics">Metrics</a> and an embedded Jetty) but all the libraries are easily changeable if you want to use something different. In our case, we needed to manage the DB migrations but didn’t want to use Liquidbase, the library that came wih Dropwizard. So we looked around and picked <a href="http://flywaydb.org">Flyway</a>, a lighter alternative. Migration scripts in Flyway are written in pure SQL so they are easy to understand and maintain.
<br /><br />
Flyway gives you three ways of configure your migrations: <a href="http://flywaydb.org/documentation/commandline/">Command Line Tool</a>, <a href="http://flywaydb.org/documentation/api/">API</a> that can be called from Java and a plugin for a few build tools like <a href="http://flywaydb.org/documentation/maven/">Maven</a> and <a href="http://flywaydb.org/documentation/gradle/">Gradle</a>. Initially for our project we opted to use the plugin for Gradle so we create our tasks like that:
<br /></p>

<pre><code>    flyway {
        def yamlConfig = new Yaml().load(new File('application-config.yml').newReader())
        def dbConfig = yamlConfig.database

        user = dbConfig.user
        password = dbConfig.password
        url = dbConfig.url
    }

    // Configure the run task to start the Dropwizard service
    run {
        dependsOn flywayMigrate
        args 'server', 'servicio-usuario.yml'
    }
    test {
        dependsOn flywayMigrate
        ....
    }
</code></pre>

<p>By making the task run and test dependant of flyway we make sure the DB is in the correct stage every time we execute the application or run the tests. And although this is a great use fo flyway we soon understood that our app needed something different: we obviously need our production environment to run the migrations but we won’t have gradle in there so, what else can we do?
<br /><br />
This is when we decided to use the flyway API and call it from the code when the application starts up. I have a <a href="https://gist.github.com/mariagomez/a0e1011bfb8b0cca0c9d">gist</a> that show how you can do it following some of Dropwizard practices. Basically, Dropwizard has this notion of <a href="http://dropwizard.readthedocs.org/en/latest/manual/core.html#bundles">bundles</a> that can be attached to the app on start up. That is how you wire up your ORM and your IoC container. So for Flyway we created a custom bundle that connects to the database using the configuration details and run the migrations.
<br /></p>

<pre><code>    public class DBMigrationsBundle implements ConfiguredBundle&lt;HelloWorldConfiguration&gt;{
        @Override
        public void run(HelloWorldConfiguration configuration, Environment environment) throws Exception {
            Flyway flyway = new Flyway();
            flyway.setDataSource(configuration.getDataSourceFactory().getUrl(),
                                configuration.getDataSourceFactory().getUser(),
                                configuration.getDataSourceFactory().getPassword());
            flyway.migrate();
        }

        @Override
        public void initialize(Bootstrap&lt;?&gt; bootstrap) {

        }
    }
</code></pre>

<p>We are now sure that whatever environment we deploy the app, it will run the migrations.</p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          
	<img src="http://maria-gomez.me//images/me_fall_2013.jpg" class="bio-photo" alt="Maria Gomez bio photo"></a>

<h3>Maria Gomez</h3>
<p>Software Developer. Agile Coach. Thoughtworker.</p>
<a href="http://twitter.com/mariascandella" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>

<a href="http://plus.google.com/+mariagomezaguirre" class="author-social" target="_blank"><i class="icon-google-plus"></i> Google+</a>
<a href="http://linkedin.com/in/mariagomezaguirre" class="author-social" target="_blank"><i class="icon-linkedin"></i> LinkedIn</a>
<a href="http://instagram.com/mscandella" class="author-social" target="_blank"><i class="icon-instagram"></i> Instagram</a>

<a href="http://github.com/mariagomez" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>






        </div>
        <p class="byline"><strong>Dropwizard and Flyway</strong> was published on <time datetime="2014-06-25T00:00:00-04:00">June 25, 2014</time> and last modified on <time datetime="2014-06-26">June 26, 2014</time> by <a href="http://maria-gomez.me//about" title="About Maria Gomez">Maria Gomez</a>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://maria-gomez.me//posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://maria-gomez.me//software/how-to-log-audit-information-with-dropwizard/" title="How to log audit information with Dropwizard">How to log audit information with Dropwizard</a></li>
    
      <li><a href="http://maria-gomez.me//talks/divide-and-conquer-an-introduction-to-microservices/" title="Divide and Conquer - an introduction to Microservices">Divide and Conquer - an introduction to Microservices</a></li>
    
      <li><a href="http://maria-gomez.me//talks/divide-y-venceras-una-introduccion-a-los-microservices/" title="Divide y Vencerás - una introducción a los Microservices">Divide y Vencerás - una introducción a los Microservices</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 Maria Gomez. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://maria-gomez.me//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://maria-gomez.me//assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', '{"provider"=>"google", "google"=>{"tracking_id"=>"UA-55460651-1"}}']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'maria-gomez'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>